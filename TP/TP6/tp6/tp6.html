<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>


<link rel="stylesheet" type="text/css" href="css/style.css"></head><body>
<div id="container">
<div id="header">
<div id="header_toprow"> Conservatoire national des arts
et métiers </div>
<div id="header_title"> NFP121 : Programmation avancée<br>
TP n° 6 - WhileL et les Visiteurs </div>
</div>
<div id="content">
<div class="paragraphe"> Thèmes du TP :<br>
<ul>
<li>Le pattern <a href="http://www.google.fr/search?hl=fr&amp;q=composite+pattern+java&amp;btnG=Rechercher&amp;meta=" target="_blank">Composite</a></li>
<li>Le pattern <a href="http://www.google.fr/search?hl=fr&amp;q=pattern+visitor+java&amp;btnG=Rechercher&amp;meta=" target="_blank">Visiteur</a></li>
<li>le langage <a href="http://jfod.cnam.fr/progAvancee/Hennessy.pdf" target="_blank">WhileL de Hennessy</a> <i>(page
47, chapitre 4.3 an
Imperative language)</i></li>
</ul>
</div>
<br>
<hr>
<div class="question"> <img src="images/preliminaire.png" height="80" width="111"><span>Le
pattern composite</span> </div>
<div class="paragraphe"> <i><b>Aucun
programme n'est demandé dans ce
préliminaire, mais une lecture attentive facilitera l'exécution du
reste du TP</b></i><br>
<br>
Regrouper dans une hiérarchie des objets (simples, complexes y compris
récursifs). </div>
<p align="center"> <img class="win_screenshot" src="images/bluej1.png" height="353" width="493">
</p>
<div class="paragraphe"> On décrit souvent une telle
structure de
données par une une grammaire :<br>
<br>
<table class="center">
<tbody>
<tr>
<td>Informellement</td>
<td>Formilisé en :</td>
</tr>
<tr>
<td>Une Composante &nbsp;est un Composite ou
&nbsp;une Feuille
<p> Composite est composé de 0 ou plusieurs
CompositeConcret </p>
<p> Feuille est une &#8216;symbole terminal&#8217; &nbsp;un
composite
primitif&nbsp; </p>
<p> <i>de plus un </i>Composite<i> peut
être "récursif i.e.
défini en terme de </i>Composante </p>
</td>
<td>Composante ::= Composite | Feuille
<p> Composite ::= {CompositeConcret} </p>
<p> Feuille ::= &#8216;symbole terminal&#8217; </p>
<p>...</p>
</td>
</tr>
</tbody>
</table>
</div>
<br>
<br>
<br>
<div class="paragraphe"> On applique ce pattern pour
représenter la
structure d'une Expression Arithmétique sur les nombres entiers : </div>
<p align="center"> <img class="win_screenshot" src="images/bluej2.png" height="353" width="503">
</p>
<div class="paragraphe"> Avec la grammaire :<br>
<br>
<table class="center" border="1" cellpadding="2">
<tbody>
<tr>
<td>Expression ::= Binaire | Nombre | Variable
<p> Binaire ::= Addition | Multiplication | Soustraction |
Division </p>
<p> Addition ::= Expression &#8216;+&#8217; Expression </p>
<p> Multiplication ::= Expression &#8216;*&#8217; Expression </p>
<p><i>...</i></p>
<p> Nombre ::= &#8216;une valeur de type int&#8217; </p>
</td>
</tr>
</tbody>
</table>
</div>
<br>
<div class="paragraphe">En ajoutant la Multiplication, la
Division, la
soustraction et les
opérations unaires Plus, Moins et Factorielle et la possibilité de
désigner un nombre par une Variable, on obtient la structure de Données
: </div>
<br>
<p align="center"> Composite des Expressions Arithmétiques
entières<br>
<img class="win_screenshot" src="images/bluej3.png" height="325" width="786"> </p>
<hr>
<div class="question"> <img src="images/preliminaire.png" height="80" width="111"><span>Le
pattern interpreter/interpréteur </span> </div>
<div class="paragraphe">On reprend le pattern 'composite'
avec l'idée
d'effectuer un traitement
uniforme sur chacune des feuilles de la structure. Un traitement
typique est une interprétation (dans un monde connu) de la structure de
données : par exemple ici une évaluation des expressions. Pour cela on
ajoute un <b>contexte</b> à la structure de données : ici
une <b>mémoire</b>
dans laquelle nous trouverons les valeurs associées aux Variables.<br>
</div>
<br>
<p align="center"> Contexte<br>
<img class="win_screenshot" src="images/bluej4.png" height="202" width="143"> </p>
<div class="paragraphe"> Donc l'entête de la méthode
d'interprétation
dans la classe abstraite Expression est la suivante :<br>
<br>
<code><font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">interprete</font><font color="#000000">(</font><font color="#000000">Contexte&nbsp;c</font><font color="#000000">)</font><font color="#000000">;</font></code>
<br>
<br>
Ceci impose l'implémentation de cette méthode par chaque feuille de la
structure de données.<br>
Les choix d'implantation de la classe Mémoire sont fixés, cf. le code
java correspondant.<br>
Enfin, une classe de tests unitaires montrent quelques utilisations de
l'interpréteur.<br>
<br>
<b>Remarques :</b><br>
<ul>
<li>l'évaluation n'est pas la seule interprétation possible des
expressions.</li>
<li>l'affichage des expressions (infixé, postfixé, préfixé)
peut être
vu comme une interprétation.</li>
<li>La simplification (évaluation des sous expressions purement
numériques) en est une aussi.</li>
<li>etc...</li>
<li>Donc,
pour implémenter une nouvelle interprétation il faut "ouvrir"
pratiquement toutes les classes de la structure de données avec tous
les dangers que cela comporte.</li>
<li>Alors dans la question1 nous allons utiliser le pattern
visiteur
pour éviter cette opération.</li>
</ul>
</div>
<br>
<hr>
<div class="question"> <img src="images/question1.png" height="80" width="101"> <span>Le pattern
visitor/visiteur</span> </div>
<div class="paragraphe">Idée : Pour éviter l'ouverture et
la
modification de toutes les classes
de la structure pour l'implantation d'une nouvelle méthode, on décide
d'implanter toutes les méthodes de manipulation de la structure dans
des classes externes dites "visiteur". Alors dans chaque classe de la
structure on ne trouve plus qu'une seule méthode qui accepte un
visiteur.<br>
<br>
Ainsi la classe Expression devrait s'écrire : </div>
<div class="codesource"> <code> <font color="#7f0055"><b>package&nbsp;</b></font><font color="#000000">question1;</font> <br>
<br>
<font color="#7f0055"><b>public&nbsp;abstract&nbsp;class&nbsp;</b></font><font color="#000000">Expression&nbsp;</font><font color="#000000">{</font> <br>
<font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">accepter</font><font color="#000000">(</font><font color="#000000">Visiteur&nbsp;v</font><font color="#000000">)</font><font color="#000000">;</font>
<br>
<font color="#000000">}</font> </code>
<p> <code><font color="#7f0055"><b>//
En utilisant la généricité de
java<br>
// public&nbsp;</b></font><font color="#000000">&lt;T&gt;&nbsp;T&nbsp;accepter(VisiteurExpression&lt;T&gt;&nbsp;v){&nbsp;</font><font color="#7f0055"><b>return&nbsp;</b></font><font color="#000000">v.visite(</font><font color="#7f0055"><b>this</b></font><font color="#000000">);&nbsp;}</font></code>
</p>
</div>
<p align="center"> Pattern visitor<br>
<img class="win_screenshot" src="images/structure.png" height="441" width="748"> </p>
<div class="paragraphe">Reprendre les Expressions du
paquetage
"preliminaire" et implanter par
le pattern visiteur les différentes interprétations proposées :
Evaluation (VisiteurEvaluation), Affichage infixe (VisiteurInfixe),
Affichage Postfixe (VisiteurPostfixe).<br>
<br>
<b>En
vous inspirant de la classe VisiteurInfixe qui est complète, complétez
les classes VisiteurEvaluation et VisiteurPostfixe et proposez les
tests des classes de tests appropriés (cf : classe TestsAFaire).</b><br>
<br>
Remarque :<br>
<br>
Toutes les classes feuilles contiennent la même méthode :<br>
<br>
<code><font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#000000">&lt;T&gt;&nbsp;T&nbsp;accepter</font><font color="#000000">(</font><font color="#000000">VisiteurExpression&lt;T&gt;&nbsp;v</font><font color="#000000">){&nbsp;</font><font color="#7f0055"><b>return&nbsp;</b></font><font color="#000000">v.visite</font><font color="#000000">(</font><font color="#7f0055"><b>this</b></font><font color="#000000">)</font><font color="#000000">;&nbsp;</font><font color="#000000">}</font></code> <br>
</div>
<br>
<hr>
<div class="question"> <img src="images/question2.png" height="80" width="101"> <span>Les Expressions
Booléennes</span> </div>
<div class="paragraphe">Reproduire pour les Expressions
Booléennes ce
qui a été obtenu à la
question 1 pour les Expressions Arithmétiques.<br>
<br>
Diagramme de Classes à respecter : </div>
<p align="center"> <img class="win_screenshot" src="images/bluej5.png" height="352" width="672">
</p>
<div class="paragraphe"> Remarques :<br>
<ul>
<li>Cette structure de données est complète vous n'avez rien à
y
ajouter.</li>
<li>Pas de variables booléennes.</li>
<li>2 constantes seulement Vrai et Faux.</li>
<li>Un seul opérateur unaire : Non.</li>
<li>Deux sortes d'opérateurs binaires :
<ul>
<li>Les opérations booléennes</li>
<li>Les "Relations" sont des opérateurs entre Expressions
Arithmétiques à résultat booléen</li>
</ul>
</li>
</ul>
<br>
Les visiteurs à implanter sont les suivants : </div>
<p align="center"> <img class="win_screenshot" src="images/bluej6.png" height="232" width="532">
</p>
<div class="paragraphe"> Remarques :<br>
<ul>
<li>Pas de visiteur par défaut.</li>
<li>VisiteurBoolString correspond au visiteur infixe des
Expressions
Arithmétiques</li>
<li>Nouveau visiteur : VisiteurBoolTojava. Il s'agit d'obtenir
une
expression booléenne syntaxiquement correcte pour java</li>
</ul>
</div>
<p><b><u>AIDE :</u></b> </p>
<ul>
<li>Rappel : Dans une classe générique, le type <tt><b>T</b></tt>
doit forcément être une classe.</li>
<li>L'évaluation d'une expression se fait dans un certain
"contexte"
(ici, une mémoire) permettant de stocker la valeur des variables.</li>
<li>Pour savoir ce qu'il faut faire en cas de division par
zéro,
regardez attentivement <tt>TestAVerifier</tt>.</li>
</ul>
<br>
<hr>
<div class="question"> <img src="images/question2_1.png" height="80" width="111"><span>Le
visiteur "VisiteurBoolTojava"</span> </div>
<div class="paragraphe"> <b><u>Code à écrire</u></b>
: Complétez le
visiteur "VisiteurBoolTojava" ; "vérifiez" avec le compilateur <tt>javac</tt>
(et grâce à la classe de tests fournie) que le code java est
syntaxiquement correct.</div>
<br>
<hr>
<div class="question"> <img src="images/question2_2.png" height="80" width="111"><span>Le
visiteur "VisiteurBoolEvaluation"</span> </div>
<div class="paragraphe"> <b><u>Code à écrire</u></b>
: Complétez le
visiteur "VisiteurBoolEvaluation" et proposez une classe de tests de ce
visiteur.
<p>&nbsp;</p>
</div>
<br>
<hr>
<div class="question"> <img src="images/question3_1.png" height="80" width="111"><span>WhileL
: un (très) petit langage impératif</span> </div>
<div class="paragraphe"> Les instructions de WhileL sont
représentées
dans le composite : </div>
<p align="center"> <img class="win_screenshot" src="images/bluej7.png" height="363" width="483">
</p>
<div class="paragraphe"> Remarques :
<ul>
<li>L'affectation (= en java) est la seule instruction à
modifier le
contexte.</li>
<li>La Séquence est le ';' de java.</li>
<li>La Sélection est le classique if-then-else (else optionnel)</li>
<li>Iteration &lt;&lt;abstract&gt;&gt; car il y
a plus d'un type de
boucle</li>
<li>Assertion : même idée que assert de java<br>
</li>
<li>Afficher : même idée que System.out.println() de java</li>
</ul>
<br>
Les visiteurs d'évaluation et de 'traduction' en java sont demandés : </div>
<p align="center"> <img class="win_screenshot" src="images/bluej8.png" height="233" width="543">
</p>
<div class="paragraphe"> Ci-dessous, une spécification de
l'interprétation/exécution d'une instruction : </div>
<br>
<table class="center">
<tbody>
<tr>
<td>Spécification informelle : <br>
Rappel : l'exécution d'une instruction modifie l'état d'une Mémoire M, <br>
une variable (par exemple X) est une adresse &nbsp;de la Mémoire M</td>
<td>Spécification formelle : règle d'inférence
&nbsp;cf. <a href="http://jfod.cnam.fr/progAvancee/Hennessy.pdf" target="_blank">livre
de Hennessy</a>
<p> Description d'une règle d'inférence : au dessus du
trait les
hypothèses à assurer<br>
pour affirmer la conclusion en dessous du trait. Exemple la première
règle ci dessous<br>
peut se lire : au dessus du trait : "si dans le contexte de la mèmoire
M l'expression Expr est évaluée dans l'entier N" alors conclusion en
dessous du trait :<br>
"dans le même contexte M l'affection X = Exp modifie la mémoire tel que
maintenant <br>
M[X]=N </p>
</td>
</tr>
<tr>
<td>L'affectation : <strong>X=Exp</strong>. si
avant exécution
l'état de la Mémoire est M
<ol>
<li>Evaluation de Exp dans un entier N cf. question 1</li>
<li>modification de la mémoire en X </li>
</ol>
<p> après exécution l'état de la Mémoire est M1 i.e.
maintenant
M[X]=N </p>
</td>
<td bgcolor="#ffffff">
<p align="center"> &lt;M&gt;,Exp -<strong>visite</strong>-&gt;
N<br>
___________________________<br>
&lt;M&gt;, X = Exp -<strong>visite</strong>-&gt;
<strong>&lt;</strong>M[X]=N&gt; </p>
</td>
</tr>
<tr>
<td>La sélection, <strong>si(Bexp)alorsI1 sinon I2 </strong>:
si avant exécution l'état de la Mémoire est M
<ol>
<li>Evaluation de Bexp dans une valeur Booléenne </li>
<li>Evaluation de I1 ou I2 selon la valeur trouvée en 1 </li>
</ol>
<p> après exécution l'état de la Mémoire est M1 ou M2 selon
2. </p>
<p> La sélection, <strong>si(Bexp)alorsI1</strong>:
si avant
exécution l'état de la Mémoire est M </p>
<ol>
<li>Evaluation de Bexp </li>
<li>Evaluation de I1 ou "ne rien faire" selon la valeur
trouvée
en 1 </li>
</ol>
<p> après exécution l'état de la Mémoire est M1 ou M
&nbsp;(inchangée) selon 2. </p>
</td>
<td bgcolor="#ffffff">
<p align="center"> &lt;M&gt;,Bexp -<strong>visite</strong>-&gt;
vrai<br>
&lt;M&gt;,I1 -<strong>visite</strong>-&gt; M1<br>
___________________________________<br>
&lt;M&gt;,si(Bexp)alors I1 sinon I2-<strong>visite</strong>-&gt;
&lt;M1&gt; </p>
<p align="center"> &lt;M&gt;,Bexp -<strong>visite</strong>-&gt;
faux<br>
&lt;M&gt;,I2 -<strong>visite</strong>-&gt; M2<br>
___________________________________<br>
&lt;<strong>M</strong>&gt;,si(Bexp)alorsI1 sinon I2-<strong>visite</strong>-&gt;
&lt;M2&gt; </p>
</td>
</tr>
<tr>
<td>La séquence : <strong>I1';'I2 </strong>:
si avant exécution
l'état de la Mémoire est M
<ol>
<li>Evaluation de I1 qui transforme la mémoire M en la
mémoire
M1 </li>
<li>PUIS Evaluation de I2 à partir de M1 <br>
donc qui qui transforme la mémoire M en la mémoire M2 </li>
</ol>
<p>après exécution l'état de la Mémoire est M2.</p>
</td>
<td>
<p align="center"> &lt;M&gt;,I1 -<strong>visite</strong>-&gt;
&lt;M1&gt;<br>
&lt;M1&gt;,I2 -<strong>visite</strong>-&gt;
&lt;M2&gt;<br>
______________________<br>
&lt;M&gt;,I1';'I2-<strong>visite</strong>-&gt;
&lt;M2&gt; </p>
</td>
</tr>
<tr>
<td>la boucle <strong>for (init,Bexp,inc) faire I1</strong>:
si
avant exécution l'état de la Mémoire est M
<ol>
<li>Se transforme en un appel à tantque&nbsp; </li>
</ol>
</td>
<td>
<p align="center"> <br>
&lt;M&gt;,Init ';' tantque(Bexp)faire I1;inc-<strong>visite</strong>-&gt;
&lt;M1&gt;<br>
_____________________________________<br>
&lt;M&gt;,for(Init,Bexp,inc)faire I1-<strong>visite</strong>-&gt;
&lt;M1&gt; </p>
</td>
</tr>
<tr>
<td>la boucle <strong>tantque (Bexp) faire I1</strong>:
si avant
exécution l'état de la Mémoire est M
<ol>
<li>Evaluation de Bexp </li>
<li>si Bexp est évaluée à vrai alors Evaluation de <strong>I1';'
tantque(Bexp)faire I1</strong> </li>
<li>si Bexp est évaluée à faux "ne rien faire" </li>
</ol>
</td>
<td>
<p align="center"> &lt;M&gt;,Bexp -<strong>visite</strong>-&gt;
faux<br>
________________________________<br>
&lt;M&gt;,tantque(Bexp) faire I1-<strong>visite</strong>-&gt;
&lt;M&gt; </p>
<p align="center"> <br>
&lt;M&gt;,Bexp -<strong>visite</strong>-&gt;
vrai<br>
&lt;M&gt;,I1';' tantque(Bexp)faire I1-<strong>visite</strong>-&gt;
&lt;M1&gt;<br>
_____________________________________<br>
&lt;M&gt;,tantque(Bexp)faire I1-<strong>visite</strong>-&gt;
&lt;M1&gt; </p>
</td>
</tr>
</tbody>
</table>
<br>
<div class="paragraphe"> Complétez les visiteurs "<b>VisiteurInstEvaluation</b>"
et "<b>VisiteurInstTojava</b>".
Vérifiez que le code obtenu avec "VisiteurInstTojava" est bien
syntaxiquement correct pour java. (cf. classe Classejava du paquetage
question3) vous devez le compiler sans erreur, sur votre poste avec votre installation java cf. <span style="font-weight: bold;">javac Exemple.java</span>. <br>
<br>
<span style="font-weight: bold;">Remarques</span> :
<ul>
<li>Servez-vous
impérativement des règles d'évaluation ci-dessus pour implémenter le
VisiteurInstEvalution, par exemple <span style="font-weight: bold;">n'utilisez
pas l'instruction while,
ni for de java</span> afin d'implémenter le TantQue de WhileL... </li>
<li>Le visiteur "VisiteurToString" est complet</li>
</ul>
</div>
<br>
<hr>
<div class="question"> <img src="images/question3_2.png" height="80" width="112"><span>La
boucle "Pour"</span> </div>
<div class="paragraphe">On a ajouté la boucle "Pour" au
paquetage
question3 sur le modèle de la
boucle "for" java (cf. classe "Pour"). Modifiez les visiteurs en
conséquence.
<p>Remarque : </p>
</div>
&nbsp;&nbsp;&nbsp; Servez-vous de la&nbsp; règle
d'évaluation ci-dessus
pour implémenter le VisiteurInstEvalution, (n'utilisez pas le for de
java afin d'implémenter le Pour de WhileL...)<br>
<hr>
<div class="question"> <img src="images/question3_3.png" height="80" width="112"><span>Les
classes de tests</span> </div>
<div class="paragraphe"> Vérifiez le bon fonctionnement
des classes de
Tests. </div>
<hr><div class="question"><img src="images/postliminaire.png"><span>Optionnel, les visiteurs et la génération de byte code.</span> </div>
<div class="paragraphe"><small><font color="#800000" size="4"><small><span style="font-weight: bold;"><br>
Aucune soumission à JNEWS n'est demandée</span>. Dans
ce postliminaire, trois visiteurs ont été développés afin de générer un
code intermédiaire (nommé bytecode, <a href="https://fr.wikipedia.org/wiki/Bytecode_Java">https://fr.wikipedia.org/wiki/Bytecode_Java</a>) pour notre petit langage WhileL à destination d'une machine java. <br>
<br>
<img style="width: 705px; height: 282px;" alt="" src="images/postliminaire_jasmin.jpg"><br><br></small></font></small><small><font color="#800000" size="4"><small>&nbsp;&nbsp; L'exécution des visiteurs engendre un code </small></font><a href="http://jasmin.sourceforge.net/"><font color="#800000" size="4"><small><span style="font-weight: bold;">Jasmin, https://fr.wikipedia.org/wiki/Jasmin_(langage)</span>,</small></font></a><font color="#800000" size="4"><small> qui est ensuite exécuté, cf. la classe de tests de ce paquetage.<br>
<br>
<span style="font-weight: bold;">Optionnel</span> : <span style="font-weight: bold;">ajoutez votre exemple de génération de code à la classe de tests.<br>
<br>
</span>Votre exemple sera ajouté à la classe de tests, pour vos successeurs ...<br>
<br>
</small></font></small>
<p><big>Liens utiles :&nbsp;</big></p>
<p style="margin-left: 40px;"><big><a href="http://jfod.cnam.fr/NFP121/supports/extras_jvm.pdf">http://jfod.cnam.fr/NFP121/supports/extras_jvm.pdf&nbsp;</a></big></p>
<p style="margin-left: 40px;"><big><a href="http://www-igm.univ-mlv.fr/%7Eforax/ens/java-avance/cours/pdf/old/Generation%20de%20code%203.pdf">http://www-igm.univ-mlv.fr/~forax/ens/java-avance/cours/pdf/old/Generation%20de%20code%203.pdf</a></big></p>
<br>
<small><font color="#800000" size="4"><small>un exemple : <br>
<br>
<big><span style="font-weight: bold;">Le calcul du pgcd en java</span></big><br>
<span style="font-weight: bold;"></span>
</small></font></small><img style="width: 547px; height: 283px;" src="./images/moz-screenshot.jpg" alt=""><br>
<br>
<big style="font-weight: bold; color: rgb(102, 0, 0);"><big>Ce même calcul en WhileL</big></big><br>
<img style="width: 916px; height: 454px;" src="./images/moz-screenshot-2.jpg" alt=""><br>
<br>
<big style="font-weight: bold; color: rgb(102, 0, 0);"><big>Ce même calcul en Jasmin (un extrait)<br>
</big></big><img style="width: 283px; height: 710px;" src="./images/moz-screenshot-3.jpg" alt=""><br>
<br></div>
<hr></div>
<div id="footer"> <a class="lien" href="http://jfod.cnam.fr/" target="_blank">JFOD</a>
| <a class="lien" href="http://deptmedia.cnam.fr/phpBB3/viewforum.php?f=40" target="_blank">FORUM</a> | <a class="lien" href="http://www.cnam.fr/" target="_blank">CNAM</a>
</div>
</div>
<hr>
</body></html>